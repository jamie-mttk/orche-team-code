import{d as L,h as E,c as I,a as e,t as B,b as t,e as z,I as M,f as u,i as J,w as o,j as N,F as O,k as q,l as x,g as p,_ as P,r as h,m as H,o as K,E as D,n as j,p as X,q as ee,u as te,s as ae}from"./index-BEaTRiqt.js";import{a as le,b as R,c as Y}from"./index-CaYEjiCe.js";import{P as se}from"./index-kk8ZeESb.js";import{_ as Q,d as oe}from"./Form.vue_vue_type_script_setup_true_lang-alu_-Csx.js";import"./request-D85rebqp.js";const ne={class:"agent-card"},re={class:"card-header"},ie={class:"agent-info"},de={class:"agent-name"},ce={class:"agent-meta"},ue={class:"meta-item"},me={class:"card-actions"},pe={class:"card-content"},_e={class:"agent-description"},ge={key:0,class:"agent-tags"},ve=L({__name:"AgentCard",props:{agent:{},allTags:{default:()=>[]}},emits:["edit","delete","execute"],setup(T,{emit:C}){const s=T,d=C,r=E(()=>!s.agent.tags||!Array.isArray(s.agent.tags)||!s.allTags?[]:s.agent.tags.map(c=>s.allTags.find(m=>m._id===c)).filter(c=>c!==void 0)),_=c=>c?new Date(c).toLocaleDateString("zh-CN",{year:"numeric",month:"short",day:"numeric"}):"未知时间",i=()=>{d("edit",s.agent)},w=()=>{d("execute",s.agent)},b=()=>{d("delete",s.agent)};return(c,m)=>{const l=u("el-button"),a=u("el-tag");return p(),I("div",ne,[e("div",re,[e("div",ie,[e("h3",de,B(c.agent.name),1),e("div",ce,[e("span",ue,[t(M,{name:"mdiClock"}),z(" "+B(_(c.agent._insertTime||c.agent._updateTime)),1)])])]),e("div",me,[t(l,{type:"primary",size:"small",circle:"",onClick:J(i,["stop"])},{default:o(()=>[t(M,{name:"mdiPencil"})]),_:1}),t(l,{type:"success",size:"small",circle:"",onClick:J(w,["stop"])},{default:o(()=>[t(M,{name:"mdiPlay"})]),_:1}),t(l,{type:"danger",size:"small",circle:"",onClick:J(b,["stop"])},{default:o(()=>[t(M,{name:"mdiDelete"})]),_:1})])]),e("div",pe,[e("p",_e,B(c.agent.description||"暂无描述"),1),r.value.length>0?(p(),I("div",ge,[(p(!0),I(O,null,q(r.value,V=>(p(),x(a,{key:V._id,size:"small",type:"info",class:"tag-item"},{default:o(()=>[z(B(V.name),1)]),_:2},1024))),128))])):N("",!0)])])}}}),fe=P(ve,[["__scopeId","data-v-8d328db7"]]),he={class:"agent-list-view"},ye={class:"main-content"},be={class:"left-panel"},ke={class:"right-panel"},we={class:"filter-header"},$e={class:"filter-title"},Ve={class:"filter-section"},Ae={class:"filter-section"},xe={class:"tag-list"},Te={key:0,class:"no-tags-tip"},Ce=L({__name:"AgentList",props:{agents:{}},emits:["add","edit","delete","execute"],setup(T){const C=T,s=h(""),d=h([]),r=h([]),_=()=>{try{const l=localStorage.getItem("agentList_searchName"),a=localStorage.getItem("agentList_selectedTags");l&&(s.value=l),a&&(d.value=JSON.parse(a))}catch(l){console.error("加载用户偏好设置失败:",l)}},i=()=>{try{localStorage.setItem("agentList_searchName",s.value),localStorage.setItem("agentList_selectedTags",JSON.stringify(d.value))}catch(l){console.error("保存用户偏好设置失败:",l)}},w=async()=>{try{const l=await le.queryTags();l.data&&(r.value=l.data.list)}catch(l){console.error("加载标签失败:",l),D.error("加载标签失败")}},b=E(()=>{let l=C.agents;return s.value&&(l=l.filter(a=>a.name?.toLowerCase().includes(s.value.toLowerCase()))),d.value.length>0&&(l=l.filter(a=>!a.tags||!Array.isArray(a.tags)?!1:d.value.some(V=>a.tags.includes(V)))),l}),c=()=>{i()},m=()=>{s.value="",d.value=[],i()};return H(s,()=>{i()}),K(()=>{w(),_()}),(l,a)=>{const V=u("el-col"),k=u("el-row"),g=u("el-empty"),n=u("el-button"),v=u("el-input"),f=u("el-checkbox"),y=u("el-checkbox-group"),U=u("el-card");return p(),I("div",he,[t(se,{title:"智能体列表",icon:"robot","show-add-button":!0,"add-button-text":"新增智能体",onAdd:a[0]||(a[0]=A=>l.$emit("add"))}),e("div",ye,[e("div",be,[t(k,{gutter:20,class:"agent-cards"},{default:o(()=>[(p(!0),I(O,null,q(b.value,A=>(p(),x(V,{key:A._id||"",span:4,xs:12,sm:8,md:6,lg:6,xl:4},{default:o(()=>[t(fe,{agent:A,allTags:r.value,onEdit:a[1]||(a[1]=$=>l.$emit("edit",$)),onDelete:a[2]||(a[2]=$=>l.$emit("delete",$)),onExecute:a[3]||(a[3]=$=>l.$emit("execute",$))},null,8,["agent","allTags"])]),_:2},1024))),128))]),_:1}),b.value.length===0?(p(),x(g,{key:0,description:"暂无智能体数据",class:"empty-state"})):N("",!0)]),e("div",ke,[t(U,{class:"filter-panel"},{header:o(()=>[e("div",we,[e("div",$e,[t(M,{name:"mdiFilter"}),a[6]||(a[6]=e("span",null,"过滤条件",-1))]),t(n,{onClick:m,type:"info",size:"small",plain:""},{default:o(()=>[...a[7]||(a[7]=[z(" 清除所有过滤 ",-1)])]),_:1})])]),default:o(()=>[e("div",Ve,[a[8]||(a[8]=e("h4",null,"按名称搜索",-1)),t(v,{modelValue:s.value,"onUpdate:modelValue":a[4]||(a[4]=A=>s.value=A),placeholder:"按名称搜索智能体",clearable:"",style:{"margin-top":"6px"}},{prefix:o(()=>[t(M,{name:"mdiMagnify"})]),_:1},8,["modelValue"])]),e("div",Ae,[a[10]||(a[10]=e("h4",null,"标签过滤",-1)),e("div",xe,[t(y,{modelValue:d.value,"onUpdate:modelValue":a[5]||(a[5]=A=>d.value=A),onChange:c},{default:o(()=>[(p(!0),I(O,null,q(r.value,A=>(p(),x(f,{key:A._id,label:A._id,class:"tag-checkbox"},{default:o(()=>[z(B(A.name),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"]),r.value.length===0?(p(),I("div",Te,[t(M,{name:"mdiInformation"}),a[9]||(a[9]=e("span",null,"暂无标签数据",-1))])):N("",!0)])])]),_:1})])])])}}}),Ie=P(Ce,[["__scopeId","data-v-81b8fac1"]]),Me={class:"agent-card-item"},De={class:"agent-avatar"},Se={class:"agent-info"},Be={class:"agent-name"},Ee={class:"agent-description"},ze={class:"agent-action"},Ne=L({__name:"AgentCardItem",props:{agent:{},actionType:{}},emits:["action"],setup(T,{emit:C}){const s=T,d=C,r=E(()=>s.actionType==="add"?"mdiPlus":"mdiDelete"),_=i=>{i.stopPropagation(),d("action",s.agent,s.actionType)};return(i,w)=>(p(),I("div",Me,[e("div",De,[t(M,{name:"mdiAccount",size:"medium"})]),e("div",Se,[e("h5",Be,B(i.agent.name),1),e("p",Ee,B(i.agent.description||"暂无描述"),1)]),e("div",ze,[t(M,{name:r.value,onClick:_},null,8,["name"])])]))}}),Z=P(Ne,[["__scopeId","data-v-2dc0fbd9"]]),Ue={class:"dialog-header"},Le={class:"search-container"},Pe={class:"member-selector-content"},Fe={class:"dialog-footer"},Re=L({__name:"AgentMemberSelector",props:j({modelValue:{type:Boolean},selectedMembers:{},excludeId:{}},{modelValue:{type:Boolean},modelModifiers:{}}),emits:j(["update:modelValue","add"],["update:modelValue"]),setup(T,{emit:C}){const s=T,d=C,r=X(T,"modelValue"),_=h([]),i=h(""),w=h(!1),b=E(()=>_.value.filter(g=>s.excludeId&&g._id===s.excludeId||s.selectedMembers.includes(g._id||"")?!1:i.value?g.name?.toLowerCase().includes(i.value.toLowerCase())||!1:!0)),c=async()=>{try{w.value=!0;const k=await R.searchAgents();_.value=k.data.list||[]}catch(k){console.error("加载智能体列表失败:",k),D.error("加载智能体列表失败"),_.value=[]}finally{w.value=!1}},m=k=>{k._id&&(d("add",k._id),i.value="")},l=()=>{},a=()=>{r.value=!1,i.value=""};return H(()=>r.value,()=>{r.value&&c()}),(k,g)=>{const n=u("el-input"),v=u("el-col"),f=u("el-row"),y=u("el-empty"),U=u("el-button"),A=u("el-dialog");return p(),x(A,{modelValue:r.value,"onUpdate:modelValue":g[1]||(g[1]=$=>r.value=$),title:"选择合作智能体",width:"60%","close-on-click-modal":!1,"append-to-body":!0,"close-on-press-escape":!1},{header:o(()=>[e("div",Ue,[g[2]||(g[2]=e("h3",null,"选择合作智能体",-1)),e("div",Le,[t(n,{modelValue:i.value,"onUpdate:modelValue":g[0]||(g[0]=$=>i.value=$),placeholder:"搜索智能体名称",clearable:"",onInput:l,style:{width:"300px"}},{prefix:o(()=>[t(M,{name:"mdiMagnify"})]),_:1},8,["modelValue"])])])]),footer:o(()=>[e("span",Fe,[t(U,{onClick:a},{default:o(()=>[...g[3]||(g[3]=[z("关闭",-1)])]),_:1})])]),default:o(()=>[e("div",Pe,[t(f,{gutter:16,class:"member-grid"},{default:o(()=>[(p(!0),I(O,null,q(b.value,$=>(p(),x(v,{key:$._id,span:4,xs:12,sm:8,md:6,lg:4,xl:4},{default:o(()=>[t(Z,{agent:$,"action-type":"add",onAction:m},null,8,["agent"])]),_:2},1024))),128))]),_:1}),b.value.length===0?(p(),x(y,{key:0,description:"暂无可用智能体","image-size":100})):N("",!0)])]),_:1},8,["modelValue"])}}}),Oe=P(Re,[["__scopeId","data-v-3b34ae3d"]]),qe={class:"members-section"},We={key:0,class:"selected-members"},Je=L({__name:"AgentMembersManager",props:{modelValue:{},excludeId:{},showDialog:{type:Boolean}},emits:["update:modelValue","update:showDialog"],setup(T,{emit:C}){const s=T,d=C,r=E({get:()=>s.showDialog||!1,set:m=>d("update:showDialog",m)}),_=h([]),i=E(()=>!s.modelValue||!_.value.length?[]:_.value.filter(m=>s.modelValue.includes(m._id||""))),w=async()=>{try{const m=await R.searchAgents();_.value=m.data.list||[]}catch(m){console.error("加载智能体列表失败:",m),D.error("加载智能体列表失败"),_.value=[]}},b=m=>{const l=[...s.modelValue];l.includes(m)||(l.push(m),d("update:modelValue",l))},c=m=>{if(!m._id)return;const l=s.modelValue.filter(a=>a!==m._id);d("update:modelValue",l)};return K(()=>{w()}),(m,l)=>{const a=u("el-col"),V=u("el-row");return p(),I("div",qe,[i.value.length>0?(p(),I("div",We,[t(V,{gutter:16,class:"selected-grid"},{default:o(()=>[(p(!0),I(O,null,q(i.value,k=>(p(),x(a,{key:k._id,span:4,xs:12,sm:8,md:6,lg:4,xl:4},{default:o(()=>[t(Z,{agent:k,"action-type":"remove",onAction:c},null,8,["agent"])]),_:2},1024))),128))]),_:1})])):N("",!0),t(Oe,{modelValue:r.value,"onUpdate:modelValue":l[0]||(l[0]=k=>r.value=k),"selected-members":m.modelValue,"exclude-id":m.excludeId,onAdd:b},null,8,["modelValue","selected-members","exclude-id"])])}}}),je=P(Je,[["__scopeId","data-v-674ed127"]]),He={class:"agent-form-container"},Ke={class:"page-header"},Ge={class:"page-title"},Qe={class:"form-content"},Xe={class:"collapse-title"},Ye={class:"collapse-title"},Ze={class:"collapse-title"},et=L({__name:"AgentDetail",props:{agent:{},isEdit:{type:Boolean},submitting:{type:Boolean}},emits:["submit","back"],setup(T,{emit:C}){const s=T,d=C,r=h({}),_=h(),i=h(),w=h(["basic","config","members"]),b=h(!1),c=h({config:{},members:[]}),m=E({get:()=>c.value.members||[],set:f=>{c.value.members=f}}),l={props:{labelWidth:"100px"},children:[{key:"name",label:"名称",size:1,mandatory:!0},{key:"description",label:"描述",size:1,mandatory:!0,props:{type:"multiple",rows:6}},{key:"tags",label:"标签",size:1,mode:"select",props:{url:"/agentTag/query",multiple:!0}}]},a=async()=>{if(!c.value.agentTemplate)return;const f=await Y.getTemplateByKey(c.value.agentTemplate);r.value=f.data},V=E(()=>{if(r.value&&r.value.ui){const f=r.value.ui;return f.props||(f.props={}),f.props.labelWidth||(f.props.labelWidth="100px"),f}return{}}),k=E(()=>r.value&&r.value.props&&Array.isArray(r.value.props)?r.value.props.includes("SUPPORT_MEMBER"):!1),g=()=>{c.value=oe(s.agent||{config:{},members:[]})},n=()=>{d("back")},v=async()=>{try{await _.value?.validate(),await i.value?.validate(),d("submit",c.value)}catch{D.error("请检查表单填写是否正确")}};return H(()=>c.value.agentTemplate,f=>{f&&a()}),K(()=>{g(),a()}),(f,y)=>{const U=u("el-button"),A=u("el-page-header"),$=u("el-collapse-item"),W=u("el-empty"),G=u("el-badge"),S=u("el-collapse");return p(),I("div",He,[e("div",Ke,[t(A,{onBack:n,title:"返回"},{content:o(()=>[e("span",Ge,B(f.isEdit?"编辑智能体":"创建智能体"),1)]),extra:o(()=>[t(U,{type:"primary",onClick:v,loading:f.submitting},{default:o(()=>[z(B(f.isEdit?"保存修改":"创建智能体"),1)]),_:1},8,["loading"])]),_:1})]),e("div",Qe,[t(S,{modelValue:w.value,"onUpdate:modelValue":y[3]||(y[3]=F=>w.value=F)},{default:o(()=>[t($,{name:"basic"},{title:o(()=>[e("div",Xe,[t(M,{name:"mdiAccount"}),y[4]||(y[4]=e("span",{class:"title-text"},"基本信息",-1))])]),default:o(()=>[t(Q,{ref_key:"basicFormRef",ref:_,config:l,data:c.value||{}},null,8,["data"])]),_:1}),t($,{name:"config"},{title:o(()=>[e("div",Ye,[t(M,{name:"mdiCog"}),y[5]||(y[5]=e("span",{class:"title-text"},"智能体配置",-1))])]),default:o(()=>[V.value.children&&V.value.children.length>0?(p(),x(Q,{key:0,ref_key:"configFormRef",ref:i,config:V.value,data:c.value.config||{}},null,8,["config","data"])):(p(),x(W,{key:1,description:"此智能体不需要任何配置","image-size":120}))]),_:1}),k.value?(p(),x($,{key:0,name:"members"},{title:o(()=>[e("div",Ze,[t(M,{name:"mdiRobot"}),y[7]||(y[7]=e("span",{class:"title-text"},"合作智能体",-1)),t(G,{value:c.value.members?.length||0,class:"member-badge"},null,8,["value"]),t(U,{type:"primary",size:"small",onClick:y[0]||(y[0]=J(F=>b.value=!0,["stop"])),style:{"margin-left":"10px"}},{default:o(()=>[t(M,{name:"mdiPlus"}),y[6]||(y[6]=z(" 添加合作智能体 ",-1))]),_:1})])]),default:o(()=>[t(je,{modelValue:m.value,"onUpdate:modelValue":y[1]||(y[1]=F=>m.value=F),"exclude-id":s.agent?._id,"show-dialog":b.value,"onUpdate:showDialog":y[2]||(y[2]=F=>b.value=F)},null,8,["modelValue","exclude-id","show-dialog"])]),_:1})):N("",!0)]),_:1},8,["modelValue"])])])}}}),tt=P(et,[["__scopeId","data-v-3d082d71"]]),at={class:"dialog-header"},lt={class:"search-container"},st={class:"template-selector"},ot={class:"template-list"},nt={class:"template-content"},rt={class:"template-name"},it={class:"template-description"},dt={class:"template-key"},ct={class:"dialog-footer"},ut=L({__name:"AgentTemplateSelector",props:j({modelValue:{type:Boolean}},{modelValue:{type:Boolean},modelModifiers:{}}),emits:j(["update:modelValue","select"],["update:modelValue"]),setup(T,{emit:C}){const s=C,d=X(T,"modelValue"),r=h([]),_=h(""),i=h(null),w=h(!1),b=E(()=>_.value?r.value.filter(g=>g.name.toLowerCase().includes(_.value.toLowerCase())):r.value),c=async()=>{try{w.value=!0;const g=await Y.searchTemplates();r.value=g.data.list||[]}catch(g){console.error("加载智能体模板失败:",g),D.error("加载智能体模板失败"),r.value=[]}finally{w.value=!1}},m=()=>{i.value=null},l=g=>{i.value=g},a=()=>{i.value&&(s("select",i.value),d.value=!1,i.value=null,_.value="")},V=()=>{d.value=!1,i.value=null,_.value=""};return H(()=>d.value,()=>{d.value&&c()}),(g,n)=>{const v=u("el-input"),f=u("el-tag"),y=u("el-card"),U=u("el-col"),A=u("el-row"),$=u("el-empty"),W=u("el-button"),G=u("el-dialog");return p(),x(G,{modelValue:d.value,"onUpdate:modelValue":n[1]||(n[1]=S=>d.value=S),width:"60%","close-on-click-modal":!1,"close-on-press-escape":!1},{header:o(()=>[e("div",at,[n[2]||(n[2]=e("h3",null,"选择智能体模板",-1)),e("div",lt,[t(v,{modelValue:_.value,"onUpdate:modelValue":n[0]||(n[0]=S=>_.value=S),placeholder:"搜索模板名称",clearable:"",onInput:m,style:{width:"300px"}},{prefix:o(()=>[t(M,{name:"magnify"})]),_:1},8,["modelValue"])])])]),footer:o(()=>[e("span",ct,[t(W,{onClick:V},{default:o(()=>[...n[3]||(n[3]=[z("取消",-1)])]),_:1}),t(W,{type:"primary",disabled:!i.value,onClick:a},{default:o(()=>[...n[4]||(n[4]=[z(" 确定 ",-1)])]),_:1},8,["disabled"])])]),default:o(()=>[e("div",st,[e("div",ot,[t(A,{gutter:20},{default:o(()=>[(p(!0),I(O,null,q(b.value,S=>(p(),x(U,{key:S._id,span:8,style:{"margin-bottom":"20px"}},{default:o(()=>[t(y,{class:ee(["template-card",{selected:i.value?._id===S._id}]),onClick:F=>l(S),hoverable:""},{default:o(()=>[e("div",nt,[e("h3",rt,B(S.name),1),e("p",it,B(S.description||"暂无描述"),1),e("div",dt,[t(f,{size:"small",type:"info"},{default:o(()=>[z(B(S.key),1)]),_:2},1024)])])]),_:2},1032,["class","onClick"])]),_:2},1024))),128))]),_:1}),b.value.length===0?(p(),x($,{key:0,description:"暂无模板","image-size":100})):N("",!0)])])]),_:1},8,["modelValue"])}}}),mt=P(ut,[["__scopeId","data-v-5998e01c"]]),pt={class:"agent-management-page"},_t=L({__name:"index",setup(T){const C=te(),s=h(!1),d=h(!1),r=h(!1),_=h(!1),i=h(),w=h(""),b=h([]),c=async()=>{try{const n=await R.searchAgents();b.value=n.data.list||[]}catch(n){console.error("加载智能体列表失败:",n),D.error("加载智能体列表失败"),b.value=[]}},m=async n=>{try{if(n._id){const v=await R.getAgent(n._id);i.value=v.data}else i.value=n;r.value=!0,s.value=!0}catch(v){console.error("获取智能体详情失败:",v),D.error("获取智能体详情失败")}},l=n=>{i.value={name:n.name,description:n.description,agentTemplate:n.key,config:{},members:[]},r.value=!1,s.value=!0},a=()=>{s.value=!1,d.value=!1,r.value=!1,i.value=void 0},V=async n=>{try{_.value=!0,r.value?await R.saveAgent(n):await R.saveAgent(n),D.success("保存成功"),a(),c()}catch(v){console.error("保存失败:",v),D.error("保存失败")}finally{_.value=!1}},k=async n=>{try{await ae.confirm(`确定要删除智能体 "${n.name}" 吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),n._id&&await R.deleteAgent(n._id),D.success("删除成功"),c()}catch(v){v!=="cancel"&&(console.error("删除失败:",v),D.error("删除失败"))}},g=async n=>{try{if(!n._id){D.error("智能体ID不存在");return}const v=C.resolve({name:"AgentExecute",params:{agentId:n._id}});window.open(v.href,"_blank")}catch(v){console.error("执行智能体失败:",v),D.error("执行智能体失败")}};return K(()=>{c()}),(n,v)=>(p(),I("div",pt,[s.value?N("",!0):(p(),x(Ie,{key:0,agents:b.value,"search-name":w.value,onAdd:v[0]||(v[0]=f=>d.value=!0),onEdit:m,onDelete:k,onExecute:g,"onUpdate:searchName":v[1]||(v[1]=f=>w.value=f)},null,8,["agents","search-name"])),t(mt,{modelValue:d.value,"onUpdate:modelValue":v[2]||(v[2]=f=>d.value=f),onSelect:l},null,8,["modelValue"]),s.value?(p(),x(tt,{key:1,agent:i.value,"is-edit":r.value,submitting:_.value,onSubmit:V,onBack:a},null,8,["agent","is-edit","submitting"])):N("",!0)]))}}),bt=P(_t,[["__scopeId","data-v-ba4178b2"]]);export{bt as default};
