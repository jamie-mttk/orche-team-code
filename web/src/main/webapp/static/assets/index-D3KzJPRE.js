import{d as q,h as H,c as u,a,G as R,v as _,F as Y,k as z,g as r,_ as D,t as L,l as Q,j as E,w as B,e as V,aF as ee,b as C,f as ce,aG as ve,aH as ae,aI as fe,r as $,o as pe,D as _e,E as U}from"./index-FPnQycga.js";const y={READY:"ready",PLAYING:"playing",PAUSED:"paused",GAME_OVER:"gameOver",VICTORY:"victory"},p={I:"I",O:"O",T:"T",S:"S",Z:"Z",L:"L",J:"J"},Z={[p.I]:"#00f0f0",[p.O]:"#f0f000",[p.T]:"#a000f0",[p.S]:"#00f000",[p.Z]:"#f00000",[p.L]:"#f0a000",[p.J]:"#0000f0"},te={[p.I]:[[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],[[0,0,1,0],[0,0,1,0],[0,0,1,0],[0,0,1,0]],[[0,0,0,0],[0,0,0,0],[1,1,1,1],[0,0,0,0]],[[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0]]],[p.O]:[[[1,1],[1,1]],[[1,1],[1,1]],[[1,1],[1,1]],[[1,1],[1,1]]],[p.T]:[[[0,1,0],[1,1,1],[0,0,0]],[[0,1,0],[0,1,1],[0,1,0]],[[0,0,0],[1,1,1],[0,1,0]],[[0,1,0],[1,1,0],[0,1,0]]],[p.S]:[[[0,1,1],[1,1,0],[0,0,0]],[[0,1,0],[0,1,1],[0,0,1]],[[0,0,0],[0,1,1],[1,1,0]],[[1,0,0],[1,1,0],[0,1,0]]],[p.Z]:[[[1,1,0],[0,1,1],[0,0,0]],[[0,0,1],[0,1,1],[0,1,0]],[[0,0,0],[1,1,0],[0,1,1]],[[0,1,0],[1,1,0],[1,0,0]]],[p.L]:[[[0,0,1],[1,1,1],[0,0,0]],[[0,1,0],[0,1,0],[0,1,1]],[[0,0,0],[1,1,1],[1,0,0]],[[1,1,0],[0,1,0],[0,1,0]]],[p.J]:[[[1,0,0],[1,1,1],[0,0,0]],[[0,1,1],[0,1,0],[0,1,0]],[[0,0,0],[1,1,1],[0,0,1]],[[0,1,0],[0,1,0],[1,1,0]]]},se=[{level:1,speed:1e3,requiredLines:10},{level:2,speed:900,requiredLines:12},{level:3,speed:800,requiredLines:14},{level:4,speed:700,requiredLines:16},{level:5,speed:600,requiredLines:18},{level:6,speed:500,requiredLines:20},{level:7,speed:400,requiredLines:22},{level:8,speed:350,requiredLines:24},{level:9,speed:300,requiredLines:26},{level:10,speed:250,requiredLines:28}],O=10,N=20,A=30,me={1:100,2:300,3:600,4:1e3},ye={class:"tetris-board"},he=q({__name:"TetrisBoard",props:{board:{},currentPiece:{}},setup(I){const s=I,c=H(()=>{const e=s.board.map(t=>[...t]);if(s.currentPiece){const{shape:t,x:v,y:i,type:d}=s.currentPiece,o=Z[d];for(let f=0;f<t.length;f++)for(let h=0;h<t[f].length;h++)if(t[f][h]){const x=i+f,k=v+h;x>=0&&x<N&&k>=0&&k<O&&(e[x][k]=o)}}return e});return(e,t)=>(r(),u("div",ye,[a("div",{class:"board-grid",style:R({width:`${_(O)*_(A)}px`,height:`${_(N)*_(A)}px`})},[(r(!0),u(Y,null,z(c.value,(v,i)=>(r(),u("div",{key:i,class:"board-row"},[(r(!0),u(Y,null,z(v,(d,o)=>(r(),u("div",{key:o,class:"board-cell",style:R({backgroundColor:d||"#2c3e50",width:`${_(A)}px`,height:`${_(A)}px`})},null,4))),128))]))),128))],4)]))}}),ge=D(he,[["__scopeId","data-v-01715ca1"]]),ke={class:"next-preview"},we={class:"preview-container"},be={key:1,class:"no-preview"},G=4,Le=q({__name:"NextPreview",props:{nextPiece:{}},setup(I){const s=I,c=H(()=>{if(!s.nextPiece)return[];const e=Array(G).fill(null).map(()=>Array(G).fill("")),{shape:t,type:v}=s.nextPiece,i=Z[v],d=Math.floor((G-t.length)/2),o=Math.floor((G-t[0].length)/2);for(let f=0;f<t.length;f++)for(let h=0;h<t[f].length;h++)t[f][h]&&(e[d+f][o+h]=i);return e});return(e,t)=>(r(),u("div",ke,[t[1]||(t[1]=a("h3",null,"下一个",-1)),a("div",we,[e.nextPiece?(r(),u("div",{key:0,class:"preview-grid",style:R({width:`${G*_(A)}px`,height:`${G*_(A)}px`})},[(r(!0),u(Y,null,z(c.value,(v,i)=>(r(),u("div",{key:i,class:"preview-row"},[(r(!0),u(Y,null,z(v,(d,o)=>(r(),u("div",{key:o,class:"preview-cell",style:R({backgroundColor:d||"#34495e",width:`${_(A)}px`,height:`${_(A)}px`})},null,4))),128))]))),128))],4)):(r(),u("div",be,[...t[0]||(t[0]=[a("span",null,"暂无",-1)])]))])]))}}),Ie=D(Le,[["__scopeId","data-v-a3d11e8f"]]),Pe={class:"game-info"},Se={class:"info-item"},$e={class:"info-value level"},Ae={class:"info-item"},xe={class:"info-value score"},Ce={class:"info-item"},Ee={class:"info-value"},Ge={class:"info-item"},Oe={class:"info-value target"},Ne={class:"progress-bar"},De=q({__name:"GameInfo",props:{level:{},score:{},linesCleared:{},requiredLines:{}},setup(I){const s=I,c=H(()=>Math.min(s.linesCleared/s.requiredLines*100,100));return(e,t)=>(r(),u("div",Pe,[a("div",Se,[t[0]||(t[0]=a("div",{class:"info-label"},"关卡",-1)),a("div",$e,L(e.level),1)]),a("div",Ae,[t[1]||(t[1]=a("div",{class:"info-label"},"分数",-1)),a("div",xe,L(e.score),1)]),a("div",Ce,[t[2]||(t[2]=a("div",{class:"info-label"},"已消除",-1)),a("div",Ee,L(e.linesCleared)+" 行",1)]),a("div",Ge,[t[3]||(t[3]=a("div",{class:"info-label"},"目标",-1)),a("div",Oe,L(e.requiredLines)+" 行",1)]),a("div",Ne,[a("div",{class:"progress-fill",style:R({width:`${c.value}%`})},null,4)])]))}}),Te=D(De,[["__scopeId","data-v-df63c6b6"]]),Re={class:"game-controls"},Ye=q({__name:"GameControls",props:{gameStatus:{}},emits:["start","pause","restart"],setup(I,{emit:s}){const c=s,e=()=>c("start"),t=()=>c("pause"),v=()=>c("restart");return(i,d)=>{const o=ce("el-button");return r(),u("div",Re,[i.gameStatus==="ready"||i.gameStatus==="gameOver"?(r(),Q(o,{key:0,type:"primary",size:"large",onClick:e,icon:_(ee),style:{width:"100%"}},{default:B(()=>[V(L(i.gameStatus==="ready"?"开始游戏":"重新开始"),1)]),_:1},8,["icon"])):E("",!0),i.gameStatus==="playing"||i.gameStatus==="paused"?(r(),u(Y,{key:1},[C(o,{type:"warning",size:"large",onClick:t,icon:i.gameStatus==="playing"?_(ve):_(ee),style:{width:"100%","margin-bottom":"12px"}},{default:B(()=>[V(L(i.gameStatus==="playing"?"暂停":"继续"),1)]),_:1},8,["icon"]),C(o,{type:"danger",size:"large",onClick:v,icon:_(ae),style:{width:"100%"}},{default:B(()=>[...d[0]||(d[0]=[V(" 重新开始 ",-1)])]),_:1},8,["icon"])],64)):E("",!0),i.gameStatus==="victory"?(r(),Q(o,{key:2,type:"success",size:"large",onClick:v,icon:_(ae),style:{width:"100%"}},{default:B(()=>[...d[1]||(d[1]=[V(" 再玩一次 ",-1)])]),_:1},8,["icon"])):E("",!0)])}}}),qe=D(Ye,[["__scopeId","data-v-7fb967a5"]]),Me={},Be={class:"keyboard-hint"};function Ve(I,s){return r(),u("div",Be,[...s[0]||(s[0]=[fe('<h3 data-v-f0333a51>操作说明</h3><div class="hint-list" data-v-f0333a51><div class="hint-item" data-v-f0333a51><kbd data-v-f0333a51>←</kbd><span data-v-f0333a51>左移</span></div><div class="hint-item" data-v-f0333a51><kbd data-v-f0333a51>→</kbd><span data-v-f0333a51>右移</span></div><div class="hint-item" data-v-f0333a51><kbd data-v-f0333a51>↑</kbd><span data-v-f0333a51>旋转</span></div><div class="hint-item" data-v-f0333a51><kbd data-v-f0333a51>↓</kbd><span data-v-f0333a51>加速</span></div><div class="hint-item" data-v-f0333a51><kbd data-v-f0333a51>空格</kbd><span data-v-f0333a51>瞬降</span></div><div class="hint-item" data-v-f0333a51><kbd data-v-f0333a51>P</kbd><span data-v-f0333a51>暂停</span></div></div>',2)])])}const ze=D(Me,[["render",Ve],["__scopeId","data-v-f0333a51"]]),He={class:"tetris-game"},Fe={class:"game-container"},Ue={class:"game-board-section"},Ze={key:0,class:"game-overlay"},Je={key:1,class:"game-overlay"},Xe={key:2,class:"game-overlay game-over"},je={class:"overlay-content"},Ke={key:3,class:"game-overlay victory"},We={class:"overlay-content"},Qe={class:"game-info-section"},ea=q({__name:"index",setup(I){const s=$(y.READY),c=$([]),e=$(null),t=$(null),v=$(0),i=$(0),d=$(1),o=$(null),f=H(()=>se[d.value-1]||se[0]),h=()=>{c.value=Array(N).fill(null).map(()=>Array(O).fill(""))},x=()=>{const l=Object.values(p),n=l[Math.floor(Math.random()*l.length)],m=te[n];return{type:n,shape:m[0],x:Math.floor((O-m[0][0].length)/2),y:0,rotation:0}},k=(l,n=0,m=0)=>{const{shape:w,x:P,y:g}=l;for(let b=0;b<w.length;b++)for(let S=0;S<w[b].length;S++)if(w[b][S]){const T=P+S+n,F=g+b+m;if(T<0||T>=O||F>=N||F>=0&&c.value[F][T])return!0}return!1},M=l=>{if(!e.value||s.value!==y.PLAYING)return;const n=l==="left"?-1:l==="right"?1:0,m=l==="down"?1:0;k(e.value,n,m)?l==="down"&&J():(e.value.x+=n,e.value.y+=m)},le=()=>{if(!e.value||s.value!==y.PLAYING)return;const{type:l,rotation:n}=e.value,m=te[l],w=(n+1)%m.length,P=m[w],g={...e.value,shape:P};k(g)?k(g,1,0)?k(g,-1,0)||(e.value.shape=P,e.value.rotation=w,e.value.x-=1):(e.value.shape=P,e.value.rotation=w,e.value.x+=1):(e.value.shape=P,e.value.rotation=w)},ne=()=>{if(!(!e.value||s.value!==y.PLAYING)){for(;!k(e.value,0,1);)e.value.y++;J()}},J=()=>{if(!e.value)return;const{shape:l,x:n,y:m,type:w}=e.value,P=Z[w];for(let g=0;g<l.length;g++)for(let b=0;b<l[g].length;b++)if(l[g][b]){const S=m+g,T=n+b;S>=0&&S<N&&(c.value[S][T]=P)}oe(),e.value=t.value,t.value=x(),e.value&&k(e.value)&&ue()},oe=()=>{let l=0;for(let n=N-1;n>=0;n--)c.value[n].every(m=>m!=="")&&(c.value.splice(n,1),c.value.unshift(Array(O).fill("")),l++,n++);l>0&&(v.value+=me[l]||0,i.value+=l,i.value>=f.value.requiredLines&&re())},re=()=>{d.value>=10?de():(d.value++,i.value=0,U.success(`恭喜进入第 ${d.value} 关！`),o.value!==null&&(clearInterval(o.value),X()))},X=()=>{o.value!==null&&clearInterval(o.value),o.value=window.setInterval(()=>{s.value===y.PLAYING&&M("down")},f.value.speed)},j=()=>{h(),e.value=x(),t.value=x(),v.value=0,i.value=0,d.value=1,s.value=y.PLAYING,X()},K=()=>{s.value===y.PLAYING?s.value=y.PAUSED:s.value===y.PAUSED&&(s.value=y.PLAYING)},ie=()=>{o.value!==null&&clearInterval(o.value),j()},ue=()=>{s.value=y.GAME_OVER,o.value!==null&&clearInterval(o.value),U.error("游戏结束！")},de=()=>{s.value=y.VICTORY,o.value!==null&&clearInterval(o.value),U.success("🎉 恭喜通关！")},W=l=>{if(!(s.value!==y.PLAYING&&l.key!=="p"&&l.key!=="P"&&l.key!=="Escape"))switch(l.key){case"ArrowLeft":l.preventDefault(),M("left");break;case"ArrowRight":l.preventDefault(),M("right");break;case"ArrowDown":l.preventDefault(),M("down");break;case"ArrowUp":l.preventDefault(),le();break;case" ":l.preventDefault(),ne();break;case"p":case"P":case"Escape":l.preventDefault(),K();break}};return pe(()=>{h(),window.addEventListener("keydown",W)}),_e(()=>{o.value!==null&&clearInterval(o.value),window.removeEventListener("keydown",W)}),(l,n)=>(r(),u("div",He,[a("div",Fe,[a("div",Ue,[C(ge,{board:c.value,"current-piece":e.value},null,8,["board","current-piece"]),s.value==="ready"?(r(),u("div",Ze,[...n[0]||(n[0]=[a("div",{class:"overlay-content"},[a("h1",null,"🎮 俄罗斯方块"),a("p",null,"准备开始游戏")],-1)])])):E("",!0),s.value==="paused"?(r(),u("div",Je,[...n[1]||(n[1]=[a("div",{class:"overlay-content"},[a("h1",null,"⏸️ 游戏暂停"),a("p",null,"按 P 或点击继续按钮继续游戏")],-1)])])):E("",!0),s.value==="gameOver"?(r(),u("div",Xe,[a("div",je,[n[2]||(n[2]=a("h1",null,"💀 游戏结束",-1)),a("p",null,"最终分数: "+L(v.value),1),a("p",null,"关卡: "+L(d.value),1)])])):E("",!0),s.value==="victory"?(r(),u("div",Ke,[a("div",We,[n[3]||(n[3]=a("h1",null,"🎉 恭喜通关！",-1)),n[4]||(n[4]=a("p",null,"你已经完成了所有10关！",-1)),a("p",null,"最终分数: "+L(v.value),1)])])):E("",!0)]),a("div",Qe,[C(Ie,{"next-piece":t.value},null,8,["next-piece"]),C(Te,{level:d.value,score:v.value,"lines-cleared":i.value,"required-lines":f.value.requiredLines},null,8,["level","score","lines-cleared","required-lines"]),C(qe,{"game-status":s.value,onStart:j,onPause:K,onRestart:ie},null,8,["game-status"]),C(ze)])])]))}}),ta=D(ea,[["__scopeId","data-v-67495fa1"]]);export{ta as default};
