import{d as b,f as g,l as w,g as v,w as l,b as d,B,v as I,n as P,p as T,r as _,a as o,e as E,E as L,h as C,c as D,j as W,s as q,C as X,_ as V,m as N,o as A,D as U,G as $,H as M,q as J,J as j,t as G,u as H}from"./index-BEaTRiqt.js";import{u as K,a as Q,h as f,_ as F,I as Y}from"./Form.vue_vue_type_script_setup_true_lang-alu_-Csx.js";import{s as Z,R as ee,A as te}from"./chatUtil-BgbyjKb7.js";import{h as ae}from"./request-D85rebqp.js";import"./index-CaYEjiCe.js";const ne=b({__name:"ScheduleTypeChooser",props:{data:{},disabledParent:{type:Boolean},config:{}},setup(p){const n=p,{modelValue:e}=K(n);return(s,i)=>{const r=g("el-radio-button"),u=g("el-radio-group");return v(),w(Q,{config:n.config,data:n.data},{default:l(()=>[d(u,{modelValue:I(e),"onUpdate:modelValue":i[0]||(i[0]=m=>B(e)?e.value=m:null)},{default:l(()=>[d(r,{label:"执行一次",value:"FIXED"}),d(r,{label:"周期执行",value:"SIMPLE"}),d(r,{label:"CRON",value:"CRON"})]),_:1},8,["modelValue"])]),_:1},8,["config","data"])}}}),se=[{text:"现在",value:()=>f().toDate()},{text:"1分钟后",value:()=>f().add(1,"minute").toDate()},{text:"5分钟后",value:()=>f().add(5,"minutes").toDate()},{text:"一小时后",value:()=>f().add(1,"hour").toDate()},{text:"二小时后",value:()=>f().add(2,"hours").toDate()},{text:"明天凌晨0点",value:()=>f().add(1,"day").startOf("day").toDate()},{text:"明天凌晨2点",value:()=>f().add(1,"day").startOf("day").add(2,"hours").toDate()},{text:"后天凌晨0点",value:()=>f().add(2,"days").startOf("day").toDate()},{text:"后天凌晨2点",value:()=>f().add(2,"days").startOf("day").add(2,"hours").toDate()}],oe={props:{labelWidth:"120px"},children:[{key:"mode",mode:"dynamic",size:1,label:"定时器类型",defaultVal:"FIXED",props:{component:ne}},{key:"fixedTime",mode:"datetimePicker",label:"执行时间",mandatory:!0,size:1,props:{readonly:!0,shortcuts:se},bindings:{show:"this.data.mode=='FIXED'"}},{key:"startTime",mode:"datetimePicker",label:"开始时间",size:1,props:{},bindings:{show:"this.data.mode!='FIXED'"}},{key:"endTime",mode:"datetimePicker",label:"结束时间",size:1,props:{},bindings:{show:"this.data.mode!='FIXED'"}},{key:"repeatInterval",mode:"input",label:"间隔",mandatory:!0,defaultVal:"10",size:1,props:{dataType:"number"},bindings:{show:"this.data.mode=='SIMPLE'"}},{key:"repeatUnit",mode:"select",label:"单位",mandatory:!0,defaultVal:"minute",size:1,props:{options:"hour:小时,minute:分,second:秒,milliSecond:毫秒"},bindings:{show:"this.data.mode=='SIMPLE'"}},{key:"repeatCount",mode:"inputNumber",label:"重复次数",description:`-1代表无限重复;\r
当设置为其他值时,实际执行次数为设置值+1`,mandatory:!0,defaultVal:"-1",size:1,props:{min:-1,precision:0},bindings:{show:"this.data.mode=='SIMPLE'"}},{key:"cronExpression",mode:"cron",label:"CRON表达式",mandatory:!1,size:1,bindings:{show:"this.data.mode=='CRON'"}}]},le={class:"dialog-footer"},de=b({inheritAttrs:!1,__name:"TaskScheduleDialog",props:{modelValue:{},modelModifiers:{}},emits:P(["saved"],["update:modelValue"]),setup(p,{emit:n}){const e=T(p,"modelValue"),s=n,i=_(),r=_({}),u=async()=>{try{await i.value?.validate(),e.value=!1,s("saved",r.value)}catch{L.error("请检查表单填写是否正确")}};return(m,c)=>{const y=g("el-button"),k=g("el-dialog");return v(),w(k,{title:"任务定时设置",modelValue:e.value,"onUpdate:modelValue":c[1]||(c[1]=h=>e.value=h),width:"30%","append-to-body":!0,"close-on-click-modal":!1,"close-on-press-escape":!1},{footer:l(()=>[o("span",le,[d(y,{onClick:c[0]||(c[0]=h=>e.value=!1)},{default:l(()=>[...c[2]||(c[2]=[E("取 消",-1)])]),_:1}),d(y,{type:"primary",onClick:u},{default:l(()=>[...c[3]||(c[3]=[E("确 定",-1)])]),_:1})])]),default:l(()=>[d(F,{ref_key:"taskScheduleFormRef",ref:i,data:r.value,config:I(oe)},null,8,["data","config"])]),_:1},8,["modelValue"])}}}),ie={class:"prompt-input"},re={class:"content"},ue={class:"input-section"},ce={class:"editor-container"},me={class:"actions"},pe=b({__name:"AgentRequestInput",props:{agentRuntime:{}},setup(p){const n=p,e=_({}),s=_(""),i=_(),r=C(()=>n.agentRuntime.status.value==="idle"),u=C(()=>n.agentRuntime.status.value==="executing"),m=C(()=>n.agentRuntime.status.value==="stopping"),c=async()=>{try{await i.value?.validate(),n.agentRuntime.sessionId.value?q.confirm("存在已经执行完成或失败的会话,是否启动新会话?","确认继续",{type:"warning"}).then(()=>{y()}):y()}catch(t){console.error("请检查表单填写是否正确",t),L.error("请检查表单填写是否正确")}},y=()=>{n.agentRuntime.sendRequestInput({taskName:s.value||n.agentRuntime.agent.value?.name,request:JSON.stringify(e.value)})},k=async()=>{await i.value?.validate();const t=_(!1);Y({"~":de,"~modelValue":t,"@saved":function(z,R){h(R)}},X._context,{removeEvent:"close"}),t.value=!0},h=async t=>{const a={taskName:s.value||n.agentRuntime.agent.value?.name,request:JSON.stringify(e.value),agentId:n.agentRuntime.agentId.value,scheduler:JSON.stringify(t)};await ae.post("/chat/scheduler",a),L.success("定时任务创建成功!请在定时任务里查看或停止.")},x=async()=>{await Z(n.agentRuntime.sessionId.value)};return(t,a)=>{const z=g("el-input"),R=g("el-button"),S=g("el-card");return v(),D("div",ie,[d(S,{class:"chat-card"},{header:l(()=>[...a[1]||(a[1]=[o("div",{class:"card-header"},[o("h3",null,"请求信息")],-1)])]),default:l(()=>[o("div",re,[o("div",ue,[d(z,{modelValue:s.value,"onUpdate:modelValue":a[0]||(a[0]=O=>s.value=O),placeholder:"自定义任务名称,没有使用智能体名称",maxlength:"120","show-word-limit":""},null,8,["modelValue"])]),o("div",ce,[d(F,{ref_key:"inputFormRef",ref:i,config:n.agentRuntime.agentInputConfig.value,data:e.value},null,8,["config","data"])]),o("div",me,[r.value?(v(),w(R,{key:0,type:"primary",size:"large",onClick:c},{default:l(()=>[...a[2]||(a[2]=[E(" 开始执行 ",-1)])]),_:1})):W("",!0),r.value?(v(),w(R,{key:1,type:"primary",size:"large",onClick:k},{default:l(()=>[...a[3]||(a[3]=[E(" 定时执行 ",-1)])]),_:1})):W("",!0),u.value||m.value?(v(),w(R,{key:2,type:"danger",size:"large",onClick:x,loading:m.value,disabled:!1},{default:l(()=>[...a[4]||(a[4]=[E(" 停止执行 ",-1)])]),_:1},8,["loading"])):W("",!0)])])]),_:1})])}}}),fe=V(pe,[["__scopeId","data-v-896c95a4"]]),ve={class:"result-display"},_e=b({__name:"ResultDisplay",props:{agentRuntime:{}},setup(p){return(n,e)=>{const s=g("el-card");return v(),D("div",ve,[d(s,{class:"main-card"},{header:l(()=>[...e[0]||(e[0]=[o("div",{class:"main-header"},[o("div",{class:"query-info"},[o("span",{class:"query-text"},"执行结果")])],-1)])]),default:l(()=>[d(ee,{agentRuntime:n.agentRuntime},null,8,["agentRuntime"])]),_:1})])}}}),ge=V(_e,[["__scopeId","data-v-7b189734"]]),he=b({__name:"index",props:{leftWidth:{default:30},minLeftWidth:{default:20},maxLeftWidth:{default:80},identifier:{default:"default"}},emits:["update:leftWidth"],setup(p,{emit:n}){const e=p,s=n,i=_(),r=_(!1),u=_(e.leftWidth),m=`resizablePanel_${e.identifier}`,c=()=>{try{const t=localStorage.getItem(m);if(t){const a=parseInt(t,10);!isNaN(a)&&a>=e.minLeftWidth&&a<=e.maxLeftWidth&&(u.value=a,s("update:leftWidth",u.value))}}catch(t){console.warn("Failed to load width from localStorage:",t)}},y=t=>{try{localStorage.setItem(m,t.toString())}catch(a){console.warn("Failed to save width to localStorage:",a)}};N(()=>e.leftWidth,t=>{u.value=t}),N(u,t=>{y(t)}),A(()=>{c()});const k=t=>{t.preventDefault(),r.value=!0,document.addEventListener("mousemove",h),document.addEventListener("mouseup",x),document.body.style.cursor="col-resize",document.body.style.userSelect="none"},h=t=>{if(!r.value||!i.value)return;const a=i.value.getBoundingClientRect(),z=t.clientX-a.left,R=a.width,S=z/R*100;S>=e.minLeftWidth&&S<=e.maxLeftWidth&&(u.value=Math.round(S),s("update:leftWidth",u.value))},x=()=>{r.value=!1,document.removeEventListener("mousemove",h),document.removeEventListener("mouseup",x),document.body.style.cursor="",document.body.style.userSelect=""};return U(()=>{document.removeEventListener("mousemove",h),document.removeEventListener("mouseup",x),document.body.style.cursor="",document.body.style.userSelect=""}),(t,a)=>(v(),D("div",{class:"resizable-panel",ref_key:"containerRef",ref:i},[o("div",{class:"left-panel",style:$({width:u.value+"%"})},[M(t.$slots,"left",{},void 0,!0)],4),o("div",{class:J(["resize-handle",{resizing:r.value}]),onMousedown:k},null,34),o("div",{class:"right-panel",style:$({width:100-u.value+"%"})},[M(t.$slots,"right",{},void 0,!0)],4)],512))}}),ye=V(he,[["__scopeId","data-v-89519fca"]]),Re={class:"agent-execute-container"},be={class:"page-header"},ke={class:"page-title"},xe={class:"main-content"},Se=b({__name:"index",setup(p){const n=j(),e=H(),s=new te(n.params.agentId),i=()=>{e.push("/agent")};return(r,u)=>{const m=g("el-page-header");return v(),D("div",Re,[o("div",be,[d(m,{onBack:i,title:"返回"},{content:l(()=>[o("span",ke,G(I(s).agent.value?.name),1)]),_:1})]),o("div",xe,[d(ye,{identifier:"agentExecuteMain","min-left-width":20,"max-left-width":80,"left-width":30},{left:l(()=>[d(fe,{"agent-runtime":I(s)},null,8,["agent-runtime"])]),right:l(()=>[d(ge,{"agent-runtime":I(s)},null,8,["agent-runtime"])]),_:1})])])}}}),Ve=V(Se,[["__scopeId","data-v-d881fc15"]]);export{Ve as default};
