import{d as L,h as E,c as I,a as t,t as B,b as e,e as N,I as M,f as m,i as W,w as o,j as U,F as R,k as O,l as D,g as p,_ as P,r as h,m as j,o as H,E as S,n as J,p as Q,q as Z,u as ee,s as te}from"./index-FPnQycga.js";import{a as ae,b as F,c as X}from"./index-CJGsZFYU.js";import{P as le}from"./index-BkCG6ryb.js";import{_ as G,d as se}from"./Form.vue_vue_type_script_setup_true_lang-dgRmH8Gp.js";import"./request-DQlLT5HJ.js";const oe={class:"agent-card"},ne={class:"card-header"},re={class:"agent-info"},ie={class:"agent-name"},de={class:"agent-meta"},ce={class:"meta-item"},ue={class:"card-actions"},me={class:"card-content"},pe={class:"agent-description"},_e={key:0,class:"agent-tags"},ge=L({__name:"AgentCard",props:{agent:{},allTags:{default:()=>[]}},emits:["edit","delete","execute"],setup(x,{emit:T}){const s=x,d=T,r=E(()=>!s.agent.tags||!Array.isArray(s.agent.tags)||!s.allTags?[]:s.agent.tags.map(c=>s.allTags.find(u=>u._id===c)).filter(c=>c!==void 0)),_=c=>c?new Date(c).toLocaleDateString("zh-CN",{year:"numeric",month:"short",day:"numeric"}):"未知时间",i=()=>{d("edit",s.agent)},$=()=>{d("execute",s.agent)},b=()=>{d("delete",s.agent)};return(c,u)=>{const l=m("el-button"),a=m("el-tag");return p(),I("div",oe,[t("div",ne,[t("div",re,[t("h3",ie,B(c.agent.name),1),t("div",de,[t("span",ce,[e(M,{name:"mdiClock"}),N(" "+B(_(c.agent._insertTime||c.agent._updateTime)),1)])])]),t("div",ue,[e(l,{type:"primary",size:"small",circle:"",onClick:W(i,["stop"])},{default:o(()=>[e(M,{name:"mdiPencil"})]),_:1}),e(l,{type:"success",size:"small",circle:"",onClick:W($,["stop"])},{default:o(()=>[e(M,{name:"mdiPlay"})]),_:1}),e(l,{type:"danger",size:"small",circle:"",onClick:W(b,["stop"])},{default:o(()=>[e(M,{name:"mdiDelete"})]),_:1})])]),t("div",me,[t("p",pe,B(c.agent.description||"暂无描述"),1),r.value.length>0?(p(),I("div",_e,[(p(!0),I(R,null,O(r.value,C=>(p(),D(a,{key:C._id,size:"small",type:"info",class:"tag-item"},{default:o(()=>[N(B(C.name),1)]),_:2},1024))),128))])):U("",!0)])])}}}),ve=P(ge,[["__scopeId","data-v-8d328db7"]]),fe={class:"agent-list-view"},he={class:"main-content"},ye={class:"left-panel"},be={class:"right-panel"},we={class:"filter-header"},$e={class:"filter-title"},ke={class:"filter-section"},Ve={class:"filter-section"},Ae={class:"tag-list"},xe={key:0,class:"no-tags-tip"},Te=L({__name:"AgentList",props:{agents:{}},emits:["add","edit","delete","execute"],setup(x){const T=x,s=h(""),d=h([]),r=h([]),_=()=>{try{const l=localStorage.getItem("agentList_searchName"),a=localStorage.getItem("agentList_selectedTags");l&&(s.value=l),a&&(d.value=JSON.parse(a))}catch(l){console.error("加载用户偏好设置失败:",l)}},i=()=>{try{localStorage.setItem("agentList_searchName",s.value),localStorage.setItem("agentList_selectedTags",JSON.stringify(d.value))}catch(l){console.error("保存用户偏好设置失败:",l)}},$=async()=>{try{const l=await ae.queryTags();l.data&&(r.value=l.data.list)}catch(l){console.error("加载标签失败:",l),S.error("加载标签失败")}},b=E(()=>{let l=T.agents;return s.value&&(l=l.filter(a=>a.name?.toLowerCase().includes(s.value.toLowerCase()))),d.value.length>0&&(l=l.filter(a=>!a.tags||!Array.isArray(a.tags)?!1:d.value.some(C=>a.tags.includes(C)))),l}),c=()=>{i()},u=()=>{s.value="",d.value=[],i()};return j(s,()=>{i()}),H(()=>{$(),_()}),(l,a)=>{const C=m("el-col"),w=m("el-row"),g=m("el-empty"),n=m("el-button"),v=m("el-input"),f=m("el-checkbox"),y=m("el-checkbox-group"),z=m("el-card");return p(),I("div",fe,[e(le,{title:"智能体列表",icon:"robot","show-add-button":!0,"add-button-text":"新增智能体",onAdd:a[0]||(a[0]=V=>l.$emit("add"))}),t("div",he,[t("div",ye,[e(w,{gutter:20,class:"agent-cards"},{default:o(()=>[(p(!0),I(R,null,O(b.value,V=>(p(),D(C,{key:V._id||"",span:4,xs:12,sm:8,md:6,lg:6,xl:4},{default:o(()=>[e(ve,{agent:V,allTags:r.value,onEdit:a[1]||(a[1]=k=>l.$emit("edit",k)),onDelete:a[2]||(a[2]=k=>l.$emit("delete",k)),onExecute:a[3]||(a[3]=k=>l.$emit("execute",k))},null,8,["agent","allTags"])]),_:2},1024))),128))]),_:1}),b.value.length===0?(p(),D(g,{key:0,description:"暂无智能体数据",class:"empty-state"})):U("",!0)]),t("div",be,[e(z,{class:"filter-panel"},{header:o(()=>[t("div",we,[t("div",$e,[e(M,{name:"mdiFilter"}),a[6]||(a[6]=t("span",null,"过滤条件",-1))]),e(n,{onClick:u,type:"info",size:"small",plain:""},{default:o(()=>[...a[7]||(a[7]=[N(" 清除所有过滤 ",-1)])]),_:1})])]),default:o(()=>[t("div",ke,[a[8]||(a[8]=t("h4",null,"按名称搜索",-1)),e(v,{modelValue:s.value,"onUpdate:modelValue":a[4]||(a[4]=V=>s.value=V),placeholder:"按名称搜索智能体",clearable:"",style:{"margin-top":"6px"}},{prefix:o(()=>[e(M,{name:"mdiMagnify"})]),_:1},8,["modelValue"])]),t("div",Ve,[a[10]||(a[10]=t("h4",null,"标签过滤",-1)),t("div",Ae,[e(y,{modelValue:d.value,"onUpdate:modelValue":a[5]||(a[5]=V=>d.value=V),onChange:c},{default:o(()=>[(p(!0),I(R,null,O(r.value,V=>(p(),D(f,{key:V._id,label:V._id,class:"tag-checkbox"},{default:o(()=>[N(B(V.name),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"]),r.value.length===0?(p(),I("div",xe,[e(M,{name:"mdiInformation"}),a[9]||(a[9]=t("span",null,"暂无标签数据",-1))])):U("",!0)])])]),_:1})])])])}}}),Ce=P(Te,[["__scopeId","data-v-81b8fac1"]]),Ie={class:"agent-card-item"},Me={class:"agent-avatar"},De={class:"agent-info"},Se={class:"agent-name"},Be={class:"agent-description"},Ee={class:"agent-action"},Ne=L({__name:"AgentCardItem",props:{agent:{},actionType:{}},emits:["action"],setup(x,{emit:T}){const s=x,d=T,r=E(()=>s.actionType==="add"?"mdiPlus":"mdiDelete"),_=i=>{i.stopPropagation(),d("action",s.agent,s.actionType)};return(i,$)=>(p(),I("div",Ie,[t("div",Me,[e(M,{name:"mdiAccount",size:"medium"})]),t("div",De,[t("h5",Se,B(i.agent.name),1),t("p",Be,B(i.agent.description||"暂无描述"),1)]),t("div",Ee,[e(M,{name:r.value,onClick:_},null,8,["name"])])]))}}),Y=P(Ne,[["__scopeId","data-v-2dc0fbd9"]]),Ue={class:"dialog-header"},ze={class:"search-container"},Le={class:"member-selector-content"},Pe={class:"dialog-footer"},Fe=L({__name:"AgentMemberSelector",props:J({modelValue:{type:Boolean},selectedMembers:{},excludeId:{}},{modelValue:{type:Boolean},modelModifiers:{}}),emits:J(["update:modelValue","add"],["update:modelValue"]),setup(x,{emit:T}){const s=x,d=T,r=Q(x,"modelValue"),_=h([]),i=h(""),$=h(!1),b=E(()=>_.value.filter(g=>s.excludeId&&g._id===s.excludeId||s.selectedMembers.includes(g._id||"")?!1:i.value?g.name?.toLowerCase().includes(i.value.toLowerCase())||!1:!0)),c=async()=>{try{$.value=!0;const w=await F.searchAgents();_.value=w.data.list||[]}catch(w){console.error("加载智能体列表失败:",w),S.error("加载智能体列表失败"),_.value=[]}finally{$.value=!1}},u=w=>{w._id&&(d("add",w._id),i.value="")},l=()=>{},a=()=>{r.value=!1,i.value=""};return j(()=>r.value,()=>{r.value&&c()}),(w,g)=>{const n=m("el-input"),v=m("el-col"),f=m("el-row"),y=m("el-empty"),z=m("el-button"),V=m("el-dialog");return p(),D(V,{modelValue:r.value,"onUpdate:modelValue":g[1]||(g[1]=k=>r.value=k),title:"选择合作智能体",width:"60%","close-on-click-modal":!1,"append-to-body":!0,"close-on-press-escape":!1},{header:o(()=>[t("div",Ue,[g[2]||(g[2]=t("h3",null,"选择合作智能体",-1)),t("div",ze,[e(n,{modelValue:i.value,"onUpdate:modelValue":g[0]||(g[0]=k=>i.value=k),placeholder:"搜索智能体名称",clearable:"",onInput:l,style:{width:"300px"}},{prefix:o(()=>[e(M,{name:"mdiMagnify"})]),_:1},8,["modelValue"])])])]),footer:o(()=>[t("span",Pe,[e(z,{onClick:a},{default:o(()=>[...g[3]||(g[3]=[N("关闭",-1)])]),_:1})])]),default:o(()=>[t("div",Le,[e(f,{gutter:16,class:"member-grid"},{default:o(()=>[(p(!0),I(R,null,O(b.value,k=>(p(),D(v,{key:k._id,span:4,xs:12,sm:8,md:6,lg:4,xl:4},{default:o(()=>[e(Y,{agent:k,"action-type":"add",onAction:u},null,8,["agent"])]),_:2},1024))),128))]),_:1}),b.value.length===0?(p(),D(y,{key:0,description:"暂无可用智能体","image-size":100})):U("",!0)])]),_:1},8,["modelValue"])}}}),Re=P(Fe,[["__scopeId","data-v-3b34ae3d"]]),Oe={class:"members-section"},qe={key:0,class:"selected-members"},We=L({__name:"AgentMembersManager",props:{modelValue:{},excludeId:{},showDialog:{type:Boolean}},emits:["update:modelValue","update:showDialog"],setup(x,{emit:T}){const s=x,d=T,r=E({get:()=>s.showDialog||!1,set:u=>d("update:showDialog",u)}),_=h([]),i=E(()=>!s.modelValue||!_.value.length?[]:_.value.filter(u=>s.modelValue.includes(u._id||""))),$=async()=>{try{const u=await F.searchAgents();_.value=u.data.list||[]}catch(u){console.error("加载智能体列表失败:",u),S.error("加载智能体列表失败"),_.value=[]}},b=u=>{const l=[...s.modelValue];l.includes(u)||(l.push(u),d("update:modelValue",l))},c=u=>{if(!u._id)return;const l=s.modelValue.filter(a=>a!==u._id);d("update:modelValue",l)};return H(()=>{$()}),(u,l)=>{const a=m("el-col"),C=m("el-row");return p(),I("div",Oe,[i.value.length>0?(p(),I("div",qe,[e(C,{gutter:16,class:"selected-grid"},{default:o(()=>[(p(!0),I(R,null,O(i.value,w=>(p(),D(a,{key:w._id,span:4,xs:12,sm:8,md:6,lg:4,xl:4},{default:o(()=>[e(Y,{agent:w,"action-type":"remove",onAction:c},null,8,["agent"])]),_:2},1024))),128))]),_:1})])):U("",!0),e(Re,{modelValue:r.value,"onUpdate:modelValue":l[0]||(l[0]=w=>r.value=w),"selected-members":u.modelValue,"exclude-id":u.excludeId,onAdd:b},null,8,["modelValue","selected-members","exclude-id"])])}}}),Je=P(We,[["__scopeId","data-v-674ed127"]]),je={class:"agent-form-container"},He={class:"page-header"},Ke={class:"page-title"},Ge={class:"form-content"},Qe={class:"collapse-title"},Xe={class:"collapse-title"},Ye={class:"collapse-title"},Ze=L({__name:"AgentDetail",props:{agent:{},isEdit:{type:Boolean},submitting:{type:Boolean}},emits:["submit","back"],setup(x,{emit:T}){const s=x,d=T,r=h({}),_=h(),i=h(),$=h(["basic","config","members"]),b=h(!1),c=h({config:{},members:[]}),u=E({get:()=>c.value.members||[],set:f=>{c.value.members=f}}),l={props:{labelWidth:"100px"},children:[{key:"name",label:"名称",size:1,mandatory:!0},{key:"description",label:"描述",size:1,mandatory:!0,props:{type:"multiple",rows:6}},{key:"tags",label:"标签",size:1,mode:"select",props:{url:"/agentTag/query",multiple:!0}}]},a=async()=>{if(!c.value.agentTemplate)return;const f=await X.getTemplateByKey(c.value.agentTemplate);r.value=f.data},C=E(()=>{if(r.value&&r.value.ui){const f=r.value.ui;return f.props||(f.props={}),f.props.labelWidth||(f.props.labelWidth="100px"),f}return{}}),w=E(()=>r.value&&r.value.props&&Array.isArray(r.value.props)?r.value.props.includes("SUPPORT_MEMBER"):!1),g=()=>{c.value=se(s.agent||{config:{},members:[]})},n=()=>{d("back")},v=async()=>{try{await _.value?.validate(),await i.value?.validate(),d("submit",c.value)}catch{S.error("请检查表单填写是否正确")}};return j(()=>c.value.agentTemplate,f=>{f&&a()}),H(()=>{g(),a()}),(f,y)=>{const z=m("el-button"),V=m("el-page-header"),k=m("el-collapse-item"),q=m("el-badge"),K=m("el-collapse");return p(),I("div",je,[t("div",He,[e(V,{onBack:n,title:"返回"},{content:o(()=>[t("span",Ke,B(f.isEdit?"编辑智能体":"创建智能体"),1)]),extra:o(()=>[e(z,{type:"primary",onClick:v,loading:f.submitting},{default:o(()=>[N(B(f.isEdit?"保存修改":"创建智能体"),1)]),_:1},8,["loading"])]),_:1})]),t("div",Ge,[e(K,{modelValue:$.value,"onUpdate:modelValue":y[3]||(y[3]=A=>$.value=A)},{default:o(()=>[e(k,{name:"basic"},{title:o(()=>[t("div",Qe,[e(M,{name:"mdiAccount"}),y[4]||(y[4]=t("span",{class:"title-text"},"基本信息",-1))])]),default:o(()=>[e(G,{ref_key:"basicFormRef",ref:_,config:l,data:c.value||{}},null,8,["data"])]),_:1}),e(k,{name:"config"},{title:o(()=>[t("div",Xe,[e(M,{name:"mdiCog"}),y[5]||(y[5]=t("span",{class:"title-text"},"智能体配置",-1))])]),default:o(()=>[e(G,{ref_key:"configFormRef",ref:i,config:C.value,data:c.value.config||{}},null,8,["config","data"])]),_:1}),w.value?(p(),D(k,{key:0,name:"members"},{title:o(()=>[t("div",Ye,[e(M,{name:"mdiRobot"}),y[7]||(y[7]=t("span",{class:"title-text"},"合作智能体",-1)),e(q,{value:c.value.members?.length||0,class:"member-badge"},null,8,["value"]),e(z,{type:"primary",size:"small",onClick:y[0]||(y[0]=W(A=>b.value=!0,["stop"])),style:{"margin-left":"10px"}},{default:o(()=>[e(M,{name:"mdiPlus"}),y[6]||(y[6]=N(" 添加合作智能体 ",-1))]),_:1})])]),default:o(()=>[e(Je,{modelValue:u.value,"onUpdate:modelValue":y[1]||(y[1]=A=>u.value=A),"exclude-id":s.agent?._id,"show-dialog":b.value,"onUpdate:showDialog":y[2]||(y[2]=A=>b.value=A)},null,8,["modelValue","exclude-id","show-dialog"])]),_:1})):U("",!0)]),_:1},8,["modelValue"])])])}}}),et=P(Ze,[["__scopeId","data-v-41c89fe2"]]),tt={class:"dialog-header"},at={class:"search-container"},lt={class:"template-selector"},st={class:"template-list"},ot={class:"template-content"},nt={class:"template-name"},rt={class:"template-description"},it={class:"template-key"},dt={class:"dialog-footer"},ct=L({__name:"AgentTemplateSelector",props:J({modelValue:{type:Boolean}},{modelValue:{type:Boolean},modelModifiers:{}}),emits:J(["update:modelValue","select"],["update:modelValue"]),setup(x,{emit:T}){const s=T,d=Q(x,"modelValue"),r=h([]),_=h(""),i=h(null),$=h(!1),b=E(()=>_.value?r.value.filter(g=>g.name.toLowerCase().includes(_.value.toLowerCase())):r.value),c=async()=>{try{$.value=!0;const g=await X.searchTemplates();r.value=g.data.list||[]}catch(g){console.error("加载智能体模板失败:",g),S.error("加载智能体模板失败"),r.value=[]}finally{$.value=!1}},u=()=>{i.value=null},l=g=>{i.value=g},a=()=>{i.value&&(s("select",i.value),d.value=!1,i.value=null,_.value="")},C=()=>{d.value=!1,i.value=null,_.value=""};return j(()=>d.value,()=>{d.value&&c()}),(g,n)=>{const v=m("el-input"),f=m("el-tag"),y=m("el-card"),z=m("el-col"),V=m("el-row"),k=m("el-empty"),q=m("el-button"),K=m("el-dialog");return p(),D(K,{modelValue:d.value,"onUpdate:modelValue":n[1]||(n[1]=A=>d.value=A),width:"60%","close-on-click-modal":!1,"close-on-press-escape":!1},{header:o(()=>[t("div",tt,[n[2]||(n[2]=t("h3",null,"选择智能体模板",-1)),t("div",at,[e(v,{modelValue:_.value,"onUpdate:modelValue":n[0]||(n[0]=A=>_.value=A),placeholder:"搜索模板名称",clearable:"",onInput:u,style:{width:"300px"}},{prefix:o(()=>[e(M,{name:"magnify"})]),_:1},8,["modelValue"])])])]),footer:o(()=>[t("span",dt,[e(q,{onClick:C},{default:o(()=>[...n[3]||(n[3]=[N("取消",-1)])]),_:1}),e(q,{type:"primary",disabled:!i.value,onClick:a},{default:o(()=>[...n[4]||(n[4]=[N(" 确定 ",-1)])]),_:1},8,["disabled"])])]),default:o(()=>[t("div",lt,[t("div",st,[e(V,{gutter:20},{default:o(()=>[(p(!0),I(R,null,O(b.value,A=>(p(),D(z,{key:A._id,span:8,style:{"margin-bottom":"20px"}},{default:o(()=>[e(y,{class:Z(["template-card",{selected:i.value?._id===A._id}]),onClick:_t=>l(A),hoverable:""},{default:o(()=>[t("div",ot,[t("h3",nt,B(A.name),1),t("p",rt,B(A.description||"暂无描述"),1),t("div",it,[e(f,{size:"small",type:"info"},{default:o(()=>[N(B(A.key),1)]),_:2},1024)])])]),_:2},1032,["class","onClick"])]),_:2},1024))),128))]),_:1}),b.value.length===0?(p(),D(k,{key:0,description:"暂无模板","image-size":100})):U("",!0)])])]),_:1},8,["modelValue"])}}}),ut=P(ct,[["__scopeId","data-v-5998e01c"]]),mt={class:"agent-management-page"},pt=L({__name:"index",setup(x){const T=ee(),s=h(!1),d=h(!1),r=h(!1),_=h(!1),i=h(),$=h(""),b=h([]),c=async()=>{try{const n=await F.searchAgents();b.value=n.data.list||[]}catch(n){console.error("加载智能体列表失败:",n),S.error("加载智能体列表失败"),b.value=[]}},u=async n=>{try{if(n._id){const v=await F.getAgent(n._id);i.value=v.data}else i.value=n;r.value=!0,s.value=!0}catch(v){console.error("获取智能体详情失败:",v),S.error("获取智能体详情失败")}},l=n=>{i.value={name:n.name,description:n.description,agentTemplate:n.key,config:{},members:[]},r.value=!1,s.value=!0},a=()=>{s.value=!1,d.value=!1,r.value=!1,i.value=void 0},C=async n=>{try{_.value=!0,r.value?await F.saveAgent(n):await F.saveAgent(n),S.success("保存成功"),a(),c()}catch(v){console.error("保存失败:",v),S.error("保存失败")}finally{_.value=!1}},w=async n=>{try{await te.confirm(`确定要删除智能体 "${n.name}" 吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),n._id&&await F.deleteAgent(n._id),S.success("删除成功"),c()}catch(v){v!=="cancel"&&(console.error("删除失败:",v),S.error("删除失败"))}},g=async n=>{try{if(!n._id){S.error("智能体ID不存在");return}const v=T.resolve({name:"AgentExecute",params:{agentId:n._id}});window.open(v.href,"_blank")}catch(v){console.error("执行智能体失败:",v),S.error("执行智能体失败")}};return H(()=>{c()}),(n,v)=>(p(),I("div",mt,[s.value?U("",!0):(p(),D(Ce,{key:0,agents:b.value,"search-name":$.value,onAdd:v[0]||(v[0]=f=>d.value=!0),onEdit:u,onDelete:w,onExecute:g,"onUpdate:searchName":v[1]||(v[1]=f=>$.value=f)},null,8,["agents","search-name"])),e(ut,{modelValue:d.value,"onUpdate:modelValue":v[2]||(v[2]=f=>d.value=f),onSelect:l},null,8,["modelValue"]),s.value?(p(),D(et,{key:1,agent:i.value,"is-edit":r.value,submitting:_.value,onSubmit:C,onBack:a},null,8,["agent","is-edit","submitting"])):U("",!0)]))}}),bt=P(pt,[["__scopeId","data-v-ba4178b2"]]);export{bt as default};
